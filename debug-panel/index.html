<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Engine Debug Panel</title>
    <style>
        body {
            font-family: monospace;
            margin: 0;
            padding: 20px;
            background-color: #1e1e1e;
            color: #f0f0f0;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }
        .panel {
            background-color: #252526;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .full-width {
            grid-column: 1 / -1;
        }
        h2 {
            margin-top: 0;
            border-bottom: 1px solid #555;
            padding-bottom: 10px;
            color: #dcdcaa;
        }
        button {
            background-color: #0e639c;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 3px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #1177bb;
        }
        pre {
            background-color: #333;
            padding: 10px;
            border-radius: 3px;
            overflow: auto;
            max-height: 300px;
            color: #d4d4d4;
        }
        .value-display {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            background-color: #333;
            border-radius: 5px;
        }
        .label {
            font-size: 14px;
            color: #9cdcfe;
            margin-bottom: 5px;
        }
        .component-container {
            margin-top: 15px;
            padding: 10px;
            background-color: #2d2d2d;
            border-radius: 5px;
        }
        .footer {
            margin-top: 20px;
            text-align: center;
            color: #666;
            font-size: 12px;
        }
        .exports-list {
            color: #9cdcfe;
            font-size: 12px;
            margin-bottom: 10px;
        }
        .log-entry {
            margin: 3px 0;
            border-bottom: 1px solid #333;
            padding-bottom: 3px;
        }
        .input-group {
            display: flex;
            margin-bottom: 10px;
        }
        input {
            background-color: #3c3c3c;
            border: 1px solid #555;
            color: white;
            padding: 8px;
            border-radius: 3px;
            flex: 1;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel full-width">
            <h2>Token Engine Debug Panel</h2>
            <div>
                <button id="btn-run-add">Test 1+1=2</button>
            </div>
            <div id="wasm-exports" class="exports-list">Loading WASM exports...</div>
        </div>

        <div class="panel">
            <h2>Counter Component</h2>
            <div class="value-display" id="counter-value">0</div>
            <div>
                <button id="btn-counter-inc">Increment</button>
                <button id="btn-counter-reset">Reset</button>
            </div>
        </div>

        <div class="panel">
            <h2>Add Function</h2>
            <div class="component-container">
                <div class="label">Values to Add:</div>
                <div class="input-group">
                    <input type="number" id="add-a" value="5" />
                    <input type="number" id="add-b" value="3" />
                </div>
                <button id="btn-calculate">Calculate</button>
                <div class="value-display" id="add-result">?</div>
            </div>
        </div>

        <div class="panel full-width">
            <h2>Debug Logs</h2>
            <pre id="debug-logs">Initializing...</pre>
        </div>
    </div>

    <div class="footer">
        Token Engine Debug Panel | WASM Debug Build | <span id="wasm-version">Loading...</span>
    </div>

    <script type="module">
        // Import the WASM module
        import * as wasmModule from "./token-engine/pkg/token_engine.js";

        let simpleCounter;

        async function initWasm() {
            try {
                console.log("Starting WASM initialization...");
                // Log available exports
                console.log("WASM module contents:", wasmModule);
                
                // Initialize the module
                if (wasmModule.default) {
                    await wasmModule.default();
                    console.log("WASM module initialized");
                }
                
                // Display available exports
                const exports = Object.keys(wasmModule);
                document.getElementById("wasm-exports").textContent = `Available exports: ${exports.join(", ")}`;
                
                // Set version
                document.getElementById("wasm-version").textContent = "WASM Initialized";
                
                // Create components
                if (wasmModule.SimpleCounter) {
                    simpleCounter = new wasmModule.SimpleCounter();
                    console.log("SimpleCounter created");
                    document.getElementById("counter-value").textContent = simpleCounter.value();
                } else {
                    console.warn("SimpleCounter not found in module");
                    document.getElementById("debug-logs").textContent = "SimpleCounter not found in module";
                }
                
                // Set up event listeners
                setupEventListeners();
                
                // Test add function
                if (wasmModule.add) {
                    const result = wasmModule.add(1, 1);
                    document.getElementById("add-result").textContent = result;
                    document.getElementById("debug-logs").textContent = `Simple test: 1 + 1 = ${result}`;
                }
                
                console.log("WASM initialization complete");
            } catch (error) {
                console.error("Error initializing WASM module:", error);
                document.getElementById("debug-logs").textContent = `Error: ${error.message}`;
            }
        }

        function setupEventListeners() {
            // Add function test
            document.getElementById("btn-calculate").addEventListener("click", () => {
                if (wasmModule.add) {
                    const a = parseInt(document.getElementById("add-a").value) || 0;
                    const b = parseInt(document.getElementById("add-b").value) || 0;
                    const result = wasmModule.add(a, b);
                    document.getElementById("add-result").textContent = result;
                    document.getElementById("debug-logs").textContent += `\nCalculated ${a} + ${b} = ${result}`;
                }
            });
            
            // Counter buttons
            document.getElementById("btn-counter-inc").addEventListener("click", () => {
                if (simpleCounter) {
                    const value = simpleCounter.increment();
                    document.getElementById("counter-value").textContent = value;
                    document.getElementById("debug-logs").textContent += `\nCounter incremented to ${value}`;
                }
            });
            
            document.getElementById("btn-counter-reset").addEventListener("click", () => {
                if (simpleCounter) {
                    const value = simpleCounter.reset();
                    document.getElementById("counter-value").textContent = value;
                    document.getElementById("debug-logs").textContent += "\nCounter reset";
                }
            });
            
            // Test button
            document.getElementById("btn-run-add").addEventListener("click", () => {
                if (wasmModule.add) {
                    const result = wasmModule.add(1, 1);
                    document.getElementById("add-result").textContent = result;
                    document.getElementById("add-a").value = 1;
                    document.getElementById("add-b").value = 1;
                    document.getElementById("debug-logs").textContent += `\nBasic test: 1 + 1 = ${result}`;
                }
            });
        }

        // Initialize WASM when the page loads
        window.addEventListener("DOMContentLoaded", initWasm);
    </script>
</body>
</html>
